version: '3.7'
services:
    minio:
        container_name: minio
        image: minio/minio:RELEASE.2020-03-25T07-03-04Z
        logging:
            options:
                max-size: 10m
                max-file: "3"
        volumes:
            - ./minio/data:/data
        ports:
            - "9000:9000"
        environment:
          MINIO_ACCESS_KEY: minioadmin
          MINIO_SECRET_KEY: minioadmin
        command: server /data
        healthcheck:
          test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
          interval: 30s
          timeout: 20s
          retries: 3
    mlflow:
        container_name: mlflow
        image: mlflow
        logging:
            options:
                max-size: 10m
                max-file: "3"
        ports:
            - "5000:5000"
        depends_on:
            - minio
    airflow:
        container_name: airflow
        image: puckel/docker-airflow:1.10.9
        restart: always
        logging:
            options:
                max-size: 10m
                max-file: "3"
        volumes:
            - ./airflow/airflow_home/dags:/usr/local/airflow/dags
            - ./airflow/airflow_tmp:/tmp/airflow
        ports:
            - "8080:8080"
        environment:
            AWS_ACCESS_KEY_ID: minioadmin
            AWS_SECRET_ACCESS_KEY: minioadmin
            MLFLOW_S3_ENDPOINT_URL: http://localhost:9000
        depends_on:
            - mlflow

          
